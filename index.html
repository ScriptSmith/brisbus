<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="description" content="Live Brisbane bus tracking map using GTFS real-time data" />
  <meta name="theme-color" content="#0077cc" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Brisbane Buses" />
  <title>Brisbane Buses — Live Map (GTFS)</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="styles/styles.css" rel="stylesheet" />
</head>
<body>
  <div id="map"></div>
  
  <!-- Follow mode indicator -->
  <div id="followIndicator" class="follow-indicator">
    <span id="followIndicatorText">Following vehicle...</span>
    <button id="followIndicatorClose" class="follow-indicator-close" title="Close">✕</button>
  </div>
  
  <div class="ui">
    <h1>Brisbane buses — Live</h1>
    <div class="controls">
      <div class="controls-row">
        <div class="input-wrapper">
          <input id="routeFilter" type="text" placeholder="Filter by route" />
          <button id="clearBtn" class="clear-btn" title="Clear filter">✕</button>
        </div>
      </div>
      <div class="controls-row">
        <button id="refreshBtn" title="Refresh">🔄</button>
        <button id="autoRefreshBtn" class="toggle-btn active" title="Auto-refresh (10s)">⏱️</button>
        <button id="locateBtn" class="toggle-btn" title="Track my location (30s)">📍</button>
        <button id="toggleRoutesBtn" class="toggle-btn active" title="Toggle route lines">🛣️</button>
        <button id="snapToRouteBtn" class="toggle-btn active" title="Snap trails to routes">🧲</button>
        <button id="smoothAnimationBtn" class="toggle-btn" title="Smooth continuous animation">🎞️</button>
        <button id="slideshowBtn" class="toggle-btn" title="Slideshow mode">🎬</button>
      </div>
      <div id="slideshowControls" class="controls-row slideshow-controls-hidden">
        <button id="slideshowNextBtn" title="Next vehicle">⏭️ Next</button>
        <input id="slideshowInterval" type="number" title="Seconds per vehicle" />
        <span class="slideshow-interval-label">sec</span>
      </div>
    </div>
    <div class="meta">
      <div>Current time: <span id="currentTime">—</span></div>
      <div>Last update: <span id="lastUpdate">—</span></div>
    </div>
    <div class="legend">Source: Translink GTFS &amp; GTFS-RT (proxied) — Carto basemap</div>
  </div>

  <!-- Status bar -->
  <div id="statusBar">Initializing...</div>

  <!-- Debug toggle icon -->
  <div id="debugToggle" title="Toggle debug logs">🐛</div>

  <!-- Stats toggle icon -->
  <div id="statsToggle" title="Toggle statistics">📊</div>

  <!-- Stats box -->
  <div id="statsBox">
    <div class="stats-header">Statistics</div>
    <table class="stats-table">
      <tbody>
        <tr>
          <td class="stat-label">Total Vehicles:</td>
          <td class="stat-value" id="statTotalVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Unique Routes:</td>
          <td class="stat-value" id="statUniqueRoutes">0</td>
        </tr>
        <tr>
          <td class="stat-label">Average Speed:</td>
          <td class="stat-value" id="statAvgSpeed">—</td>
        </tr>
        <tr>
          <td class="stat-label">Fastest Vehicle:</td>
          <td class="stat-value" id="statFastestVehicle">—</td>
        </tr>
        <tr>
          <td class="stat-label">Slowest Vehicle:</td>
          <td class="stat-value" id="statSlowestVehicle">—</td>
        </tr>
        <tr>
          <td class="stat-label">Stationary Vehicles:</td>
          <td class="stat-value" id="statStationaryVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Busiest Route:</td>
          <td class="stat-value" id="statBusiestRoute">—</td>
        </tr>
        <tr>
          <td class="stat-label">Total Stops:</td>
          <td class="stat-value" id="statTotalStops">0</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Debug pane -->
  <div id="debugPane">
    <div class="debug-header">
      <span>Debug Logs</span>
      <div class="debug-controls">
        <button id="clearLogsBtn">Clear</button>
        <button id="closeDebugBtn">Close</button>
      </div>
    </div>
    <div class="debug-content" id="debugContent"></div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
