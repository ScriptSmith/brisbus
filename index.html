<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="description" content="Live Brisbane bus tracking map using GTFS real-time data" />
  <meta name="theme-color" content="#0077cc" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Brisbane Buses" />
  <title>Brisbane Buses â€” Live Map (GTFS)</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link href="https://unpkg.com/maplibre-gl@5.9.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="styles/styles.css" rel="stylesheet" />
</head>
<body>
  <div id="map"></div>
  
  <!-- Follow mode indicator -->
  <div id="followIndicator" class="follow-indicator">
    <span id="followIndicatorText">Following vehicle...</span>
    <button id="followIndicatorClose" class="follow-indicator-close" title="Close" aria-label="Close follow mode">âœ•</button>
  </div>
  
  <!-- Main UI (responsive: desktop sidebar / mobile bottom bar) -->
  <div class="ui" id="mainUI">
    <div class="ui-header">
      <h1>Brisbane buses â€” Live</h1>
      <button id="settingsBtn" class="settings-btn-inline" title="Settings" aria-label="Open settings">
        <span class="settings-icon">âš™ï¸</span>
      </button>
    </div>
    
    <!-- Desktop controls (hidden on mobile) -->
    <div class="controls desktop-controls">
      <div class="controls-row">
        <div class="input-wrapper">
          <input id="routeFilter" type="text" placeholder="Filter by route" list="routeList" aria-label="Filter routes by number" />
          <datalist id="routeList">
            <!-- Options will be populated dynamically -->
          </datalist>
          <button id="clearBtn" class="clear-btn" title="Clear filter" aria-label="Clear route filter">âœ•</button>
        </div>
      </div>
      <div class="controls-row">
        <button id="refreshBtn" title="Refresh" aria-label="Refresh vehicle data">ğŸ”„</button>
        <button id="locateBtn" class="toggle-btn" title="Track my location (30s)" aria-label="Track my location">ğŸ“</button>
      </div>
    </div>
    
    <!-- Mobile navigation buttons (hidden on desktop) -->
    <div class="mobile-nav">
      <button id="menuBtn" class="mobile-btn" title="Menu">
        <span class="mobile-icon">â˜°</span>
        <span class="mobile-label">Menu</span>
      </button>
      <button id="filterBtn" class="mobile-btn" title="Filter">
        <span class="mobile-icon">ğŸ”</span>
        <span class="mobile-label">Filter</span>
      </button>
      <button id="refreshMobileBtn" class="mobile-btn" title="Refresh">
        <span class="mobile-icon">ğŸ”„</span>
        <span class="mobile-label">Refresh</span>
      </button>
      <button id="locateMobileBtn" class="mobile-btn" title="Locate">
        <span class="mobile-icon">ğŸ“</span>
        <span class="mobile-label">Locate</span>
      </button>
      <button id="settingsMobileBtn" class="mobile-btn" title="Settings">
        <span class="mobile-icon">âš™ï¸</span>
        <span class="mobile-label">Settings</span>
      </button>
    </div>
    
    <!-- Desktop meta info (hidden on mobile) -->
    <div class="meta desktop-meta">
      <div>Current time: <span id="currentTime">â€”</span></div>
      <div>Last update: <span id="lastUpdate">â€”</span></div>
    </div>
    <div id="basemapLegend" class="legend desktop-legend">Source: Translink GTFS &amp; GTFS-RT (proxied) â€” Carto basemap</div>
  </div>

  <!-- Settings panel (responsive: desktop sidebar / mobile bottom sheet) -->
  <div id="settingsPanel" class="settings-panel">
    <div class="settings-panel-header">
      <h2>Settings</h2>
      <button id="settingsClose" class="settings-panel-close" aria-label="Close settings panel">âœ•</button>
    </div>
    <div class="settings-panel-content">
      <!-- Appearance category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Appearance</h3>
        <div class="settings-category-content">
          <div class="theme-mode-options">
            <button id="themeLightBtn" class="theme-mode-btn">
              <span class="theme-mode-icon">â˜€ï¸</span>
              <span class="theme-mode-label">Light</span>
            </button>
            <button id="themeDarkBtn" class="theme-mode-btn">
              <span class="theme-mode-icon">ğŸŒ™</span>
              <span class="theme-mode-label">Dark</span>
            </button>
            <button id="themeAutoBtn" class="theme-mode-btn active">
              <span class="theme-mode-icon">ğŸŒ—</span>
              <span class="theme-mode-label">Auto</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Data & Updates category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Data &amp; Updates</h3>
        <div class="settings-category-content">
          <button id="autoRefreshBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">â±ï¸</span>
            <span class="settings-toggle-label">Auto-refresh (10s)</span>
          </button>
        </div>
      </div>
      
      <!-- Map Display category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Map Display</h3>
        <div class="settings-category-content layer-toggles-grid">
          <button id="toggleVehiclesBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">ğŸšŒ</span>
            <span class="settings-toggle-label">Vehicles</span>
          </button>
          <button id="toggleRoutesBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">ğŸ—ºï¸</span>
            <span class="settings-toggle-label">Routes</span>
          </button>
          <button id="toggleTrailsBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">âœ¨</span>
            <span class="settings-toggle-label">Trails</span>
          </button>
          <button id="toggleStopsBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">ğŸš</span>
            <span class="settings-toggle-label">Stops</span>
          </button>
          <button id="toggle3DBuildingsBtn" class="settings-toggle-btn">
            <span class="settings-toggle-icon">ğŸ¢</span>
            <span class="settings-toggle-label">3D Buildings</span>
          </button>
        </div>
      </div>
      
      <!-- Trail Options category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Trail Options</h3>
        <div class="settings-category-content">
          <button id="snapToRouteBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">ğŸ§²</span>
            <span class="settings-toggle-label">Snap trails to routes</span>
          </button>
        </div>
      </div>
      
      <!-- Direction Filter category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Direction Filter</h3>
        <div class="settings-category-content">
          <div class="direction-filter-options">
            <button id="directionAllBtn" class="direction-filter-btn active">
              <span class="direction-filter-icon">â†”ï¸</span>
              <span class="direction-filter-label">All</span>
            </button>
            <button id="directionInboundBtn" class="direction-filter-btn">
              <span class="direction-filter-icon">â¬…ï¸</span>
              <span class="direction-filter-label">Inbound</span>
            </button>
            <button id="directionOutboundBtn" class="direction-filter-btn">
              <span class="direction-filter-icon">â¡ï¸</span>
              <span class="direction-filter-label">Outbound</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Vehicle Type Filter category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Vehicle Type Filter</h3>
        <div class="settings-category-content vehicle-type-filter-grid">
          <button id="vehicleTypeBusBtn" class="vehicle-type-filter-btn active" title="Show/hide buses">
            <span class="vehicle-type-filter-icon">ğŸšŒ</span>
            <span class="vehicle-type-filter-label">Bus</span>
          </button>
          <button id="vehicleTypeRailBtn" class="vehicle-type-filter-btn active" title="Show/hide trains">
            <span class="vehicle-type-filter-icon">ğŸš†</span>
            <span class="vehicle-type-filter-label">Train</span>
          </button>
          <button id="vehicleTypeFerryBtn" class="vehicle-type-filter-btn active" title="Show/hide ferries">
            <span class="vehicle-type-filter-icon">â›´ï¸</span>
            <span class="vehicle-type-filter-label">Ferry</span>
          </button>
          <button id="vehicleTypeTramBtn" class="vehicle-type-filter-btn active" title="Show/hide trams">
            <span class="vehicle-type-filter-icon">ğŸšŠ</span>
            <span class="vehicle-type-filter-label">Tram</span>
          </button>
        </div>
      </div>
      
      <!-- Vehicle Display category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Vehicle Display</h3>
        <div class="settings-category-content">
          <div class="vehicle-display-options">
            <button id="displayModeDotsBtn" class="vehicle-display-btn">
              <span class="vehicle-display-icon">âš«</span>
              <span class="vehicle-display-label">Dots</span>
            </button>
            <button id="displayModeEmojiBtn" class="vehicle-display-btn active">
              <span class="vehicle-display-icon">ğŸšŒ</span>
              <span class="vehicle-display-label">Emoji</span>
            </button>
            <button id="displayModeCharBtn" class="vehicle-display-btn">
              <span class="vehicle-display-icon">B</span>
              <span class="vehicle-display-label">Character</span>
            </button>
            <button id="displayModeArrowBtn" class="vehicle-display-btn">
              <span class="vehicle-display-icon">â†‘</span>
              <span class="vehicle-display-label">Arrow</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Animation & View category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Animation &amp; View</h3>
        <div class="settings-category-content">
          <button id="slideshowBtn" class="settings-toggle-btn">
            <span class="settings-toggle-icon">ğŸ¬</span>
            <span class="settings-toggle-label">Slideshow mode</span>
          </button>
        </div>
      </div>
      
      <!-- Slideshow controls -->
      <div id="slideshowControls" class="slideshow-controls-hidden">
        <div class="settings-category">
          <h3 class="settings-category-title">Slideshow Settings</h3>
          <div class="settings-category-content">
            <button id="slideshowNextBtn" class="settings-control-btn">â­ï¸ Next vehicle</button>
            <div class="slideshow-interval-wrapper">
              <label for="slideshowInterval">Interval:</label>
              <input id="slideshowInterval" type="number" title="Seconds per vehicle" />
              <span class="slideshow-interval-label">seconds</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vehicle info card (responsive: desktop popup / mobile card) -->
  <div id="vehicleCard" class="vehicle-card">
    <div class="vehicle-card-header">
      <h3 id="cardTitle">Vehicle Info</h3>
      <div class="vehicle-card-actions">
        <button id="cardMinimize" class="vehicle-card-btn" title="Minimize" aria-label="Minimize vehicle card">âˆ’</button>
        <button id="cardClose" class="vehicle-card-btn" title="Close" aria-label="Close vehicle card">âœ•</button>
      </div>
    </div>
    <div id="cardContent" class="vehicle-card-content">
      <!-- Content will be populated dynamically -->
    </div>
  </div>

  <!-- Filter panel (responsive: desktop overlay / mobile bottom sheet) -->
  <div id="filterPanel" class="filter-panel">
    <div class="filter-panel-header">
      <h2>Filter Routes</h2>
      <button id="filterClose" class="filter-panel-close" aria-label="Close filter panel">âœ•</button>
    </div>
    <div class="filter-panel-content">
      <div class="input-wrapper">
        <input id="filterInput" type="text" placeholder="Filter by route" list="filterRouteList" aria-label="Filter routes by number" />
        <datalist id="filterRouteList">
          <!-- Options will be populated dynamically -->
        </datalist>
        <button id="filterClearBtn" class="clear-btn" title="Clear filter" aria-label="Clear route filter">âœ•</button>
      </div>
    </div>
  </div>

  <!-- Menu panel (mobile only) -->
  <div id="menuPanel" class="menu-panel">
    <div class="menu-panel-header">
      <h2>Menu</h2>
      <button id="menuClose" class="menu-panel-close" aria-label="Close menu panel">âœ•</button>
    </div>
    <div class="menu-panel-content">
      <div class="menu-info-section">
        <div class="meta">
          <div>Current time: <span id="menuCurrentTime">â€”</span></div>
          <div>Last update: <span id="menuLastUpdate">â€”</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status bar -->
  <div id="statusBar">Initializing...</div>

  <!-- Debug toggle icon -->
  <div id="debugToggle" title="Toggle debug logs">ğŸ›</div>

  <!-- Stats toggle icon -->
  <div id="statsToggle" title="Toggle statistics">ğŸ“Š</div>

  <!-- Stats box -->
  <div id="statsBox">
    <div class="stats-header">Statistics</div>
    <table class="stats-table">
      <tbody>
        <tr>
          <td class="stat-label">Total Vehicles:</td>
          <td class="stat-value" id="statTotalVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Unique Routes:</td>
          <td class="stat-value" id="statUniqueRoutes">0</td>
        </tr>
        <tr>
          <td class="stat-label">Average Speed:</td>
          <td class="stat-value" id="statAvgSpeed">â€”</td>
        </tr>
        <tr>
          <td class="stat-label">Fastest Vehicle:</td>
          <td class="stat-value" id="statFastestVehicle">â€”</td>
        </tr>
        <tr>
          <td class="stat-label">Slowest Vehicle:</td>
          <td class="stat-value" id="statSlowestVehicle">â€”</td>
        </tr>
        <tr>
          <td class="stat-label">Stationary Vehicles:</td>
          <td class="stat-value" id="statStationaryVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Inbound Vehicles:</td>
          <td class="stat-value" id="statInboundVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Outbound Vehicles:</td>
          <td class="stat-value" id="statOutboundVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Busiest Route:</td>
          <td class="stat-value" id="statBusiestRoute">â€”</td>
        </tr>
        <tr>
          <td class="stat-label">Total Stops:</td>
          <td class="stat-value" id="statTotalStops">0</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Debug pane -->
  <div id="debugPane">
    <div class="debug-header">
      <span>Debug Logs</span>
      <div class="debug-controls">
        <button id="clearLogsBtn">Clear</button>
        <button id="closeDebugBtn">Close</button>
      </div>
    </div>
    <div class="debug-content" id="debugContent"></div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@5.9.0/dist/maplibre-gl.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
