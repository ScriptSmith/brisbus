<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="description" content="Live Brisbane bus tracking map using GTFS real-time data" />
  <meta name="theme-color" content="#0077cc" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Brisbane Buses" />
  <title>Brisbane Buses — Live Map (GTFS)</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="styles/styles.css" rel="stylesheet" />
</head>
<body>
  <div id="map"></div>
  
  <!-- Settings menu button (desktop only) -->
  <button id="settingsBtn" class="settings-btn" title="Settings">
    <span class="settings-icon">⚙️</span>
  </button>
  
  <!-- Follow mode indicator -->
  <div id="followIndicator" class="follow-indicator">
    <span id="followIndicatorText">Following vehicle...</span>
    <button id="followIndicatorClose" class="follow-indicator-close" title="Close">✕</button>
  </div>
  
  <!-- Desktop main UI -->
  <div class="ui" id="mainUI">
    <h1>Brisbane buses — Live</h1>
    <div class="controls">
      <!-- Primary actions always visible -->
      <div class="controls-row">
        <div class="input-wrapper">
          <input id="routeFilter" type="text" placeholder="Filter by route" />
          <button id="clearBtn" class="clear-btn" title="Clear filter">✕</button>
        </div>
      </div>
      <div class="controls-row">
        <button id="refreshBtn" title="Refresh">🔄</button>
        <button id="locateBtn" class="toggle-btn" title="Track my location (30s)">📍</button>
      </div>
    </div>
    <div class="meta">
      <div>Current time: <span id="currentTime">—</span></div>
      <div>Last update: <span id="lastUpdate">—</span></div>
    </div>
    <div class="legend">Source: Translink GTFS &amp; GTFS-RT (proxied) — Carto basemap</div>
  </div>

  <!-- Desktop settings panel -->
  <div id="desktopSettingsPanel" class="desktop-settings-panel">
    <div class="settings-panel-header">
      <h2>Settings</h2>
      <button id="desktopSettingsClose" class="settings-panel-close">✕</button>
    </div>
    <div class="settings-panel-content">
      <!-- Data & Updates category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Data &amp; Updates</h3>
        <div class="settings-category-content">
          <button id="autoRefreshBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">⏱️</span>
            <span class="settings-toggle-label">Auto-refresh (10s)</span>
          </button>
        </div>
      </div>
      
      <!-- Map Display category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Map Display</h3>
        <div class="settings-category-content">
          <button id="toggleRoutesBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">🛣️</span>
            <span class="settings-toggle-label">Show route lines</span>
          </button>
          <button id="snapToRouteBtn" class="settings-toggle-btn active">
            <span class="settings-toggle-icon">🧲</span>
            <span class="settings-toggle-label">Snap trails to routes</span>
          </button>
        </div>
      </div>
      
      <!-- Animation & View category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Animation &amp; View</h3>
        <div class="settings-category-content">
          <button id="smoothAnimationBtn" class="settings-toggle-btn">
            <span class="settings-toggle-icon">🎞️</span>
            <span class="settings-toggle-label">Smooth animation</span>
          </button>
          <button id="slideshowBtn" class="settings-toggle-btn">
            <span class="settings-toggle-icon">🎬</span>
            <span class="settings-toggle-label">Slideshow mode</span>
          </button>
        </div>
      </div>
      
      <!-- Slideshow controls -->
      <div id="slideshowControls" class="slideshow-controls-hidden">
        <div class="settings-category">
          <h3 class="settings-category-title">Slideshow Settings</h3>
          <div class="settings-category-content">
            <button id="slideshowNextBtn" class="settings-control-btn">⏭️ Next vehicle</button>
            <div class="slideshow-interval-wrapper">
              <label for="slideshowInterval">Interval:</label>
              <input id="slideshowInterval" type="number" title="Seconds per vehicle" />
              <span class="slideshow-interval-label">seconds</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile bottom bar -->
  <div id="mobileBottomBar" class="mobile-bottom-bar">
    <button id="mobileMenuBtn" class="mobile-btn" title="Menu">
      <span class="mobile-icon">☰</span>
      <span class="mobile-label">Menu</span>
    </button>
    <button id="mobileFilterBtn" class="mobile-btn" title="Filter">
      <span class="mobile-icon">🔍</span>
      <span class="mobile-label">Filter</span>
    </button>
    <button id="mobileRefreshBtn" class="mobile-btn" title="Refresh">
      <span class="mobile-icon">🔄</span>
      <span class="mobile-label">Refresh</span>
    </button>
    <button id="mobileLocateBtn" class="mobile-btn" title="Locate">
      <span class="mobile-icon">📍</span>
      <span class="mobile-label">Locate</span>
    </button>
    <button id="mobileSettingsBtn" class="mobile-btn" title="Settings">
      <span class="mobile-icon">⚙️</span>
      <span class="mobile-label">Settings</span>
    </button>
  </div>

  <!-- Mobile vehicle info card -->
  <div id="mobileVehicleCard" class="mobile-vehicle-card">
    <div class="mobile-card-header">
      <h3 id="mobileCardTitle">Vehicle Info</h3>
      <div class="mobile-card-actions">
        <button id="mobileCardMinimize" class="mobile-card-btn" title="Minimize">−</button>
        <button id="mobileCardClose" class="mobile-card-btn" title="Close">✕</button>
      </div>
    </div>
    <div id="mobileCardContent" class="mobile-card-content">
      <!-- Content will be populated dynamically -->
    </div>
  </div>

  <!-- Mobile filter panel -->
  <div id="mobileFilterPanel" class="mobile-panel">
    <div class="mobile-panel-header">
      <h2>Filter Routes</h2>
      <button id="mobileFilterClose" class="mobile-panel-close">✕</button>
    </div>
    <div class="mobile-panel-content">
      <div class="input-wrapper">
        <input id="mobileRouteFilter" type="text" placeholder="Filter by route" />
        <button id="mobileClearBtn" class="clear-btn" title="Clear filter">✕</button>
      </div>
    </div>
  </div>

  <!-- Mobile menu panel -->
  <div id="mobileMenuPanel" class="mobile-panel">
    <div class="mobile-panel-header">
      <h2>Menu</h2>
      <button id="mobileMenuClose" class="mobile-panel-close">✕</button>
    </div>
    <div class="mobile-panel-content">
      <div class="mobile-info-section">
        <div class="meta">
          <div>Current time: <span id="mobileCurrentTime">—</span></div>
          <div>Last update: <span id="mobileLastUpdate">—</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile settings panel -->
  <div id="mobileSettingsPanel" class="mobile-panel">
    <div class="mobile-panel-header">
      <h2>Settings</h2>
      <button id="mobileSettingsClose" class="mobile-panel-close">✕</button>
    </div>
    <div class="mobile-panel-content">
      <!-- Data & Updates category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Data &amp; Updates</h3>
        <div class="mobile-toggle-section">
          <button id="mobileAutoRefreshBtn" class="mobile-toggle-btn active">
            <span class="mobile-toggle-icon">⏱️</span>
            <span class="mobile-toggle-label">Auto-refresh (10s)</span>
          </button>
        </div>
      </div>
      
      <!-- Map Display category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Map Display</h3>
        <div class="mobile-toggle-section">
          <button id="mobileToggleRoutesBtn" class="mobile-toggle-btn active">
            <span class="mobile-toggle-icon">🛣️</span>
            <span class="mobile-toggle-label">Show route lines</span>
          </button>
          <button id="mobileSnapToRouteBtn" class="mobile-toggle-btn active">
            <span class="mobile-toggle-icon">🧲</span>
            <span class="mobile-toggle-label">Snap trails to routes</span>
          </button>
        </div>
      </div>
      
      <!-- Animation & View category -->
      <div class="settings-category">
        <h3 class="settings-category-title">Animation &amp; View</h3>
        <div class="mobile-toggle-section">
          <button id="mobileSmoothAnimationBtn" class="mobile-toggle-btn">
            <span class="mobile-toggle-icon">🎞️</span>
            <span class="mobile-toggle-label">Smooth animation</span>
          </button>
          <button id="mobileSlideshowBtn" class="mobile-toggle-btn">
            <span class="mobile-toggle-icon">🎬</span>
            <span class="mobile-toggle-label">Slideshow mode</span>
          </button>
        </div>
      </div>
      
      <!-- Slideshow controls -->
      <div id="mobileSlideshowControls" class="mobile-slideshow-controls slideshow-controls-hidden">
        <div class="settings-category">
          <h3 class="settings-category-title">Slideshow Settings</h3>
          <div class="settings-category-content">
            <button id="mobileSlideshowNextBtn" class="mobile-control-btn">⏭️ Next vehicle</button>
            <div class="mobile-slideshow-interval">
              <label for="mobileSlideshowInterval">Interval:</label>
              <input id="mobileSlideshowInterval" type="number" title="Seconds per vehicle" />
              <span class="slideshow-interval-label">seconds</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status bar -->
  <div id="statusBar">Initializing...</div>

  <!-- Debug toggle icon -->
  <div id="debugToggle" title="Toggle debug logs">🐛</div>

  <!-- Stats toggle icon -->
  <div id="statsToggle" title="Toggle statistics">📊</div>

  <!-- Stats box -->
  <div id="statsBox">
    <div class="stats-header">Statistics</div>
    <table class="stats-table">
      <tbody>
        <tr>
          <td class="stat-label">Total Vehicles:</td>
          <td class="stat-value" id="statTotalVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Unique Routes:</td>
          <td class="stat-value" id="statUniqueRoutes">0</td>
        </tr>
        <tr>
          <td class="stat-label">Average Speed:</td>
          <td class="stat-value" id="statAvgSpeed">—</td>
        </tr>
        <tr>
          <td class="stat-label">Fastest Vehicle:</td>
          <td class="stat-value" id="statFastestVehicle">—</td>
        </tr>
        <tr>
          <td class="stat-label">Slowest Vehicle:</td>
          <td class="stat-value" id="statSlowestVehicle">—</td>
        </tr>
        <tr>
          <td class="stat-label">Stationary Vehicles:</td>
          <td class="stat-value" id="statStationaryVehicles">0</td>
        </tr>
        <tr>
          <td class="stat-label">Busiest Route:</td>
          <td class="stat-value" id="statBusiestRoute">—</td>
        </tr>
        <tr>
          <td class="stat-label">Total Stops:</td>
          <td class="stat-value" id="statTotalStops">0</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Debug pane -->
  <div id="debugPane">
    <div class="debug-header">
      <span>Debug Logs</span>
      <div class="debug-controls">
        <button id="clearLogsBtn">Clear</button>
        <button id="closeDebugBtn">Close</button>
      </div>
    </div>
    <div class="debug-content" id="debugContent"></div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
